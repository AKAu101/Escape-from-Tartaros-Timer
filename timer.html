<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vier-Spieler-Schachuhr</title>
  <style>
    :root {
      --bg-color: #f0f0f0;
      --text-color: #000;
      --panel-bg: #fff;
      --highlight: #d0f0d0;
      --primary: #007bff;
      --secondary: #0056b3;
      --shadow: rgba(0,0,0,0.1);
    }

    body.dark {
      --bg-color: #1e1e1e;
      --text-color: #fff;
      --panel-bg: #2c2c2c;
      --highlight: #304030;
      --primary: #3399ff;
      --secondary: #1e70c1;
      --shadow: rgba(255,255,255,0.1);
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--bg-color);
      color: var(--text-color);
    }

    #main {
      max-width: 800px;
      margin: 50px auto;
      padding: 30px 20px;
      text-align: center;
      background-color: var(--panel-bg);
      border-radius: 15px;
      box-shadow: 0 8px 16px var(--shadow);
    }

    #display {
      font-size: 64px;
      margin: 40px 0 10px;
      font-weight: bold;
    }

    #player {
      font-size: 28px;
      margin-bottom: 30px;
    }

    #controls {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 30px;
    }

    button {
      padding: 12px 24px;
      font-size: 1.1em;
      cursor: pointer;
      border-radius: 10px;
      border: none;
      transition: background-color 0.2s ease;
    }

    button:hover {
      filter: brightness(1.1);
    }

    #mainButtonContainer {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin: 20px 0;
      width: 100%;
    }

    #nextPlayerBtn {
      font-size: 5em;
      width: 90%;
      max-width: 700px;
      padding: 20px;
      background-color: #dc3545;
      color: white;
    }

    #pauseResumeBtn {
      font-size: 1.5em;
      width: 90%;
      max-width: 700px;
      padding: 10px;
      background-color: #ffc107;
      color: white;
    }

    #startBtn {
      font-size: 5em;
      padding: 16px 32px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 12px;
      margin: 20px auto;
      display: block;
      width: 90%;
      max-width: 700px;
      text-align: center;
    }

    #startBtn:hover {
      background-color: #218838;
    }

    #sidebar {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
      align-items: center;
    }

    .player-time {
      padding: 12px 18px;
      background-color: var(--panel-bg);
      border-radius: 8px;
      width: 80%;
      max-width: 300px;
      text-align: center;
      font-size: 18px;
      box-shadow: 0 2px 6px var(--shadow);
    }

    .player-time.active {
      background-color: var(--highlight);
      font-weight: bold;
    }

    #editMenuToggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: var(--primary);
      color: white;
      border-radius: 5px;
      padding: 12px 16px;
      z-index: 1001;
    }

    #editMenu {
      position: fixed;
      top: 70px;
      right: -220px;
      width: 200px;
      background-color: var(--primary);
      color: white;
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 20px;
      z-index: 1000;
      border-radius: 10px 0 0 10px;
      transition: right 0.3s ease;
    }

    #editMenu.show {
      right: 0;
    }

    #editMenu button {
      width: 100%;
      padding: 12px;
      font-size: 1.1em;
      background-color: var(--secondary);
      border-radius: 8px;
    }

    #editPanel {
      display: none;
      flex-direction: column;
      gap: 15px;
      margin-top: 30px;
    }

    .edit-mode {
      display: flex;
      align-items: center;
      gap: 10px;
      background-color: var(--panel-bg);
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 4px var(--shadow);
      justify-content: center;
      flex-wrap: wrap;
    }

    input[type="number"], input[type="text"] {
      padding: 6px;
      font-size: 1em;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .edit-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
    }

    input[type="number"], input[type="text"] {
      padding: 5px;
      font-size: 1em;
      width: 60px;
    }

    button {
      padding: 10px 16px;
      font-size: 1em;
      cursor: pointer;
      border-radius: 5px;
      border: none;
    }

    #editMenuToggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: var(--primary);
      color: white;
      border-radius: 5px;
      padding: 10px;
      z-index: 1001;
    }

    #editMenu {
      position: fixed;
      top: 70px;
      right: -200px;
      width: 180px;
      background-color: var(--primary);
      color: white;
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 15px;
      z-index: 1000;
      border-radius: 10px 0 0 10px;
      transition: right 0.3s ease;
    }

    #editMenu.show {
      right: 0;
    }

    #editMenu button {
      width: 100%;
      padding: 10px;
      font-size: 1.2em;
      background-color: var(--secondary);
      border-radius: 8px;
    }
  </style>
</head>
<body>

<div id="main">
  <div id="display">00:00.00</div>
  <div id="player">Spieler 1</div>

  <div id="mainButtonContainer" style="display:none;">
    <button id="nextPlayerBtn" onclick="stopAndNext()">‚è≠Ô∏è</button>
    <button id="pauseResumeBtn" onclick="togglePause()">‚è∏</button>
  </div>
  <button id="startBtn" onclick="startGame()">Start</button>

  <div id="controls" style="display:none;">
    <button onclick="stopAndNext()">‚è≠Ô∏è</button>
    <button id="pauseBtn" onclick="togglePause()">‚è∏</button>
    <button onclick="resetGame()">üîÅ</button>
  </div>

  <div id="sidebar"></div>
  <div id="editPanel"></div>
</div>

<button id="editMenuToggle" onclick="toggleSidebar()">‚ò∞</button>
<div id="editMenu">
  <button onclick="toggleEditMode()">‚úèÔ∏è</button>
  <button onclick="resetGame()">üîÅ</button>
  <button onclick="window.location.href='/index.html'">üè†</button>
  <button onclick="toggleDarkMode()">üåô</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
  let players = [
    { name: "Spieler 1", time: 60000 },
    { name: "Spieler 2", time: 60000 },
    { name: "Spieler 3", time: 60000 },
    { name: "Spieler 4", time: 60000 }
  ];
  let currentPlayer = 0;
  let interval = null;
  let lastTimestamp = null;
  let isPaused = false;
  let gameStarted = false;
  let editMode = false;

  const editPanel = document.getElementById("editPanel");
  const pauseBtn = document.getElementById("pauseResumeBtn");

  function formatTime(ms, withMillis = false) {
    const totalSeconds = Math.floor(ms / 1000);
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    const millis = Math.floor((ms % 1000) / 10);
    return withMillis
            ? `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(millis).padStart(2, '0')}`
            : `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
  }

  function updateDisplays() {
    document.getElementById("display").textContent = formatTime(players[currentPlayer].time, true);
    document.getElementById("player").textContent = players[currentPlayer].name;

    const sidebar = document.getElementById("sidebar");
    sidebar.innerHTML = "";
    players.forEach((p, i) => {
      const div = document.createElement("div");
      div.className = "player-time" + (i === currentPlayer ? " active" : "");
      div.textContent = `${p.name}: ${formatTime(p.time)}`;
      sidebar.appendChild(div);
    });
  }

  function startTimer() {
    if (interval || players[currentPlayer].time <= 0 || isPaused) return;
    lastTimestamp = performance.now();
    interval = setInterval(() => {
      if (isPaused) return;
      const now = performance.now();
      const delta = now - lastTimestamp;
      lastTimestamp = now;
      players[currentPlayer].time -= delta;
      if (players[currentPlayer].time <= 0) {
        players[currentPlayer].time = 0;
        clearInterval(interval);
        interval = null;
        updateDisplays();
        setTimeout(nextPlayer, 500);
      } else {
        updateDisplays();
      }
    }, 10);
  }

  function stopAndNext() {
    clearInterval(interval);
    interval = null;
    nextPlayer();
  }

  function togglePause() {
    if (!gameStarted) return;
    isPaused = !isPaused;
    pauseBtn.textContent = isPaused ? "‚ñ∂Ô∏è" : "‚è∏";
    if (!isPaused && interval === null) startTimer();
  }

  function nextPlayer() {
    let attempts = 0;
    do {
      currentPlayer = (currentPlayer + 1) % players.length;
      attempts++;
      if (attempts > players.length) {
        alert("Alle Spieler haben keine Zeit mehr!");
        return;
      }
    } while (players[currentPlayer].time <= 0);
    updateDisplays();
    startTimer();
  }

  function resetGame() {
    clearInterval(interval);
    interval = null;
    isPaused = false;
    gameStarted = false;
    players.forEach(p => p.time = 60000);
    currentPlayer = 0;
    updateDisplays();
    document.getElementById("startBtn").style.display = "inline-block";
    document.getElementById("mainButtonContainer").style.display = "none";
    pauseBtn.textContent = "‚è∏";
  }

  function startGame() {
    gameStarted = true;
    document.getElementById("startBtn").style.display = "none";
    document.getElementById("mainButtonContainer").style.display = "flex";
    startTimer();
  }

  function toggleEditMode() {
    editMode = !editMode;
    editPanel.style.display = editMode ? "flex" : "none";

    if (editMode && gameStarted) {
      isPaused = true;
      clearInterval(interval);
      interval = null;
      pauseBtn.textContent = "‚ñ∂Ô∏è";
    }

    if (!editMode) {
      // leave paused after edit, only resume manually
      updateDisplays();
      return;
    }

    editPanel.innerHTML = "";
    const list = document.createElement("div");
    list.id = "playerList";
    players.forEach((player, index) => {
      const div = document.createElement("div");
      div.className = "edit-mode";
      div.setAttribute("data-id", index);
      div.innerHTML = `
        <input type="text" value="${player.name}" onchange="players[${index}].name = this.value" />
        <input type="number" min="0" value="${Math.floor(player.time / 60000)}" onchange="updatePlayerTime(${index}, this.value, null)" /> Min
        <input type="number" min="0" max="59" value="${Math.floor((player.time % 60000) / 1000)}" onchange="updatePlayerTime(${index}, null, this.value)" /> Sek
        <button onclick="removePlayer(${index})">üóëÔ∏è</button>
      `;
      list.appendChild(div);
    });
    editPanel.appendChild(list);

    const controls = document.createElement("div");
    controls.className = "edit-buttons";
    controls.innerHTML = `
      <button onclick="addPlayer()">‚ûï Spieler hinzuf√ºgen</button>
      <button onclick="saveEdit()">‚úÖ Speichern & Schlie√üen</button>
    `;
    editPanel.appendChild(controls);

    new Sortable(list, {
      animation: 150,
      handle: ".edit-mode",
      onEnd: function (evt) {
        const item = players.splice(evt.oldIndex, 1)[0];
        players.splice(evt.newIndex, 0, item);
        toggleEditMode(); toggleEditMode();
      }
    });
  }

  function updatePlayerTime(index, minutes, seconds) {
    const currentMinutes = Math.floor(players[index].time / 60000);
    const currentSeconds = Math.floor((players[index].time % 60000) / 1000);
    const newMinutes = minutes !== null ? parseInt(minutes) : currentMinutes;
    const newSeconds = seconds !== null ? parseInt(seconds) : currentSeconds;
    players[index].time = (newMinutes * 60 + newSeconds) * 1000;
  }

  function addPlayer() {
    players.push({ name: `Spieler ${players.length + 1}`, time: 60000 });
    toggleEditMode(); toggleEditMode();
  }

  function removePlayer(index) {
    if (players.length > 2) {
      players.splice(index, 1);
      toggleEditMode(); toggleEditMode();
    } else {
      alert("Mindestens zwei Spieler m√ºssen vorhanden sein.");
    }
  }

  function saveEdit() {
    toggleEditMode();
    updateDisplays();
  }

  function toggleSidebar() {
    document.getElementById("editMenu").classList.toggle("show");
  }

  function toggleDarkMode() {
    document.body.classList.toggle("dark");
    localStorage.setItem("darkMode", document.body.classList.contains("dark"));
  }

  // Load Darkmode preference
  if (localStorage.getItem("darkMode") === "true") {
    document.body.classList.add("dark");
  }

  updateDisplays();
</script>
</body>
</html>